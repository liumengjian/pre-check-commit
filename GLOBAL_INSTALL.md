# å…¨å±€å®‰è£…ä½¿ç”¨æŒ‡å—

å¦‚æœä½ å…¨å±€å®‰è£…äº†è¿™ä¸ª npm åŒ…ï¼Œéœ€è¦åœ¨æ¯ä¸ªé¡¹ç›®ä¸­æ‰‹åŠ¨åˆå§‹åŒ–é…ç½®ã€‚

## ğŸ“¦ å…¨å±€å®‰è£…

```bash
npm install -g prina-pre-commit-check
```

## ğŸš€ åœ¨é¡¹ç›®ä¸­ä½¿ç”¨

### æ–¹å¼ä¸€ï¼šä½¿ç”¨åˆå§‹åŒ–å‘½ä»¤ï¼ˆæ¨èï¼‰

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š

```bash
pre-commit-check --init
```

æˆ–

```bash
pre-commit-check-init
```

è¿™ä¼šè‡ªåŠ¨å®Œæˆï¼š
1. âœ… æ£€æŸ¥æ˜¯å¦æ˜¯ Git ä»“åº“
2. âœ… å®‰è£…/åˆå§‹åŒ– husky
3. âœ… åˆ›å»º pre-commit hook
4. âœ… å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°é¡¹ç›®æ ¹ç›®å½•

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨åˆå§‹åŒ–

å¦‚æœè‡ªåŠ¨åˆå§‹åŒ–å¤±è´¥ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œï¼š

#### 1. ç¡®ä¿é¡¹ç›®æ˜¯ Git ä»“åº“

```bash
git init  # å¦‚æœè¿˜æ²¡æœ‰åˆå§‹åŒ–
```

#### 2. å®‰è£… huskyï¼ˆé¡¹ç›®æœ¬åœ°ï¼‰

```bash
npm install husky --save-dev
npx husky install
```

#### 3. åˆ›å»º pre-commit hook

åˆ›å»º `.husky/pre-commit` æ–‡ä»¶ï¼š

**Windows (PowerShell):**
```powershell
@"
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

pre-commit-check
"@ | Out-File -Encoding utf8 .husky/pre-commit
```

**Linux/Mac:**
```bash
cat > .husky/pre-commit << 'EOF'
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

pre-commit-check
EOF

chmod +x .husky/pre-commit
```

#### 4. å¤åˆ¶é…ç½®æ–‡ä»¶

**Windows (PowerShell):**
```powershell
# è·å–å…¨å±€åŒ…è·¯å¾„
$globalPath = npm root -g
Copy-Item "$globalPath\prina-pre-commit-check\commit-check.config.js" .
```

**Linux/Mac:**
```bash
# è·å–å…¨å±€åŒ…è·¯å¾„
GLOBAL_PATH=$(npm root -g)
cp "$GLOBAL_PATH/prina-pre-commit-check/commit-check.config.js" .
```

æˆ–è€…æ‰‹åŠ¨åˆ›å»º `commit-check.config.js` æ–‡ä»¶ï¼ˆå‚è€ƒé»˜è®¤é…ç½®ï¼‰ã€‚

## âœ… éªŒè¯é…ç½®

è¿è¡Œè¯Šæ–­å‘½ä»¤æ£€æŸ¥é…ç½®ï¼š

```bash
pre-commit-check-diagnose
```

## ğŸ§ª æµ‹è¯•

```bash
git add .
git commit -m "test: æµ‹è¯•æäº¤"
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **husky å¿…é¡»æœ¬åœ°å®‰è£…**ï¼šè™½ç„¶å·¥å…·å¯ä»¥å…¨å±€å®‰è£…ï¼Œä½† husky å¿…é¡»åœ¨æ¯ä¸ªé¡¹ç›®ä¸­æœ¬åœ°å®‰è£…
   ```bash
   npm install husky --save-dev
   ```

2. **é…ç½®æ–‡ä»¶ä½ç½®**ï¼šé…ç½®æ–‡ä»¶ `commit-check.config.js` å¿…é¡»åœ¨é¡¹ç›®æ ¹ç›®å½•

3. **Git hook è·¯å¾„**ï¼šç¡®ä¿ `.husky/pre-commit` æ–‡ä»¶ä¸­çš„å‘½ä»¤æ˜¯ `pre-commit-check`ï¼ˆå…¨å±€å‘½ä»¤ï¼‰ï¼Œè€Œä¸æ˜¯ `npx pre-commit-check`

4. **å¤šé¡¹ç›®ä½¿ç”¨**ï¼šå…¨å±€å®‰è£…åï¼Œå¯ä»¥åœ¨å¤šä¸ªé¡¹ç›®ä¸­ä½¿ç”¨ï¼Œä½†æ¯ä¸ªé¡¹ç›®éƒ½éœ€è¦å•ç‹¬åˆå§‹åŒ–

## ğŸ”„ æ›´æ–°å…¨å±€åŒ…

```bash
npm update -g prina-pre-commit-check
```

æ›´æ–°åï¼Œå·²é…ç½®çš„é¡¹ç›®æ— éœ€é‡æ–°åˆå§‹åŒ–ï¼Œä½†æ–°é¡¹ç›®éœ€è¦ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„åˆå§‹åŒ–å‘½ä»¤ã€‚

## â“ å¸¸è§é—®é¢˜

### Q: å…¨å±€å®‰è£…åï¼Œä¸ºä»€ä¹ˆè¿˜è¦åœ¨é¡¹ç›®ä¸­å®‰è£… huskyï¼Ÿ

A: husky éœ€è¦è®¿é—®é¡¹ç›®çš„ Git é…ç½®å’Œ `.husky` ç›®å½•ï¼Œæ‰€ä»¥å¿…é¡»åœ¨é¡¹ç›®æœ¬åœ°å®‰è£…ã€‚

### Q: å¯ä»¥åœ¨ package.json ä¸­æ·»åŠ è„šæœ¬å—ï¼Ÿ

A: å¯ä»¥ï¼Œä½†ä¸æ¨èã€‚å¦‚æœé¡¹ç›®ä¸­æœ‰ `package.json`ï¼Œå»ºè®®å°†å·¥å…·ä½œä¸º devDependencies å®‰è£…ï¼Œè¿™æ ·æ›´ä¾¿äºå›¢é˜Ÿåä½œå’Œç‰ˆæœ¬ç®¡ç†ã€‚

### Q: å…¨å±€å®‰è£…å’Œæœ¬åœ°å®‰è£…æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

A:
- **å…¨å±€å®‰è£…**ï¼šä¸€æ¬¡å®‰è£…ï¼Œå¤šä¸ªé¡¹ç›®ä½¿ç”¨ï¼Œä½†éœ€è¦æ¯ä¸ªé¡¹ç›®å•ç‹¬åˆå§‹åŒ–
- **æœ¬åœ°å®‰è£…**ï¼šæ¯ä¸ªé¡¹ç›®å•ç‹¬å®‰è£…ï¼Œè‡ªåŠ¨é…ç½®ï¼Œæ›´é€‚åˆå›¢é˜Ÿåä½œ

## ğŸ’¡ æ¨èåšæ³•

è™½ç„¶æ”¯æŒå…¨å±€å®‰è£…ï¼Œä½†**æ¨èåœ¨é¡¹ç›®ä¸­æœ¬åœ°å®‰è£…**ï¼š

```bash
npm install prina-pre-commit-check --save-dev
```

è¿™æ ·å¯ä»¥ï¼š
- âœ… è‡ªåŠ¨é…ç½®ï¼ˆé€šè¿‡ `prepare` è„šæœ¬ï¼‰
- âœ… ç‰ˆæœ¬é”å®šï¼ˆåœ¨ package.json ä¸­ï¼‰
- âœ… å›¢é˜Ÿåä½œï¼ˆå…¶ä»–æˆå‘˜ `npm install` åè‡ªåŠ¨é…ç½®ï¼‰
- âœ… é¡¹ç›®ç‹¬ç«‹ï¼ˆä¸åŒé¡¹ç›®å¯ä»¥ä½¿ç”¨ä¸åŒç‰ˆæœ¬ï¼‰

